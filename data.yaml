# =============================================================================
# METADATA
# =============================================================================
metadata:
  version: "1.0.0"
  game_system: "pathfinder_1e"
  schema_version: "1"

# =============================================================================
# 1) REFERENCE TABLES
# =============================================================================
reference_tables:
  # First define the string constants
  bonus_type_strings:
    untyped: &untyped "untyped"
    circumstance: &circumstance "circumstance"
    inherent: &inherent "inherent"
    enhancement: &enhancement "enhancement"
    morale: &morale "morale"
    dodge: &dodge "dodge"
    racial: &racial "racial"
    natural: &natural "natural"

  # Then define the full bonus type objects
  bonus_types:
  - &bonus_untyped_obj
    id: 1
    name: *untyped
    label: "Untyped"
  - &bonus_circumstance_obj
    id: 2
    name: *circumstance
    label: "Circumstance"
  - &bonus_inherent_obj
    id: 3
    name: *inherent
    label: "Inherent"
  - &bonus_enhancement_obj
    id: 4
    name: *enhancement
    label: "Enhancement"
  - &bonus_morale_obj
    id: 5
    name: *morale
    label: "Morale"
  - &bonus_dodge_obj
    id: 6
    name: *dodge
    label: "Dodge"
  - &bonus_racial_obj
    id: 7
    name: *racial
    label: "Racial"
  - &bonus_natural_obj
    id: 8
    name: *natural
    label: "Natural"
  # Skill Rank Sources
  skill_rank_sources:
  - &source_class
    id: &source_class_id 1
    name: "class"
    label: "Class"
  - &source_favored
    id: &source_favored_id 2
    name: "favored_class"
    label: "Favored Class"
  - &source_intelligence
    id: &source_intelligence_id 3
    name: "intelligence"
    label: "Int-based"
  - &source_other
    id: &source_other_id 4
    name: "other"
    label: "Other"
  # Buff Types
  buff_type_strings:
    mutagen: &buff_type_mutagen "mutagen"
    combat: &buff_type_combat "combat"
    other: &buff_type_other "other"

  buff_types:
  - &buff_mutagen
    id: &buff_mutagen_id 1
    name: *buff_type_mutagen
    label: "Mutagen"
  - &buff_combat
    id: &buff_combat_id 2
    name: *buff_type_combat
    label: "Combat"
  - &buff_other
    id: &buff_other_id 3
    name: *buff_type_other
    label: "Other"
  # ABP Bonus Types
  abp_bonus_types:
  - &abp_resistance
    id: &abp_resistance_id 1
    name: "resistance"
    label: "Resistance"
  - &abp_armor_attunement
    id: &abp_armor_attunement_id 2
    name: "armor_attunement"
    label: "Armor Attunement"
  - &abp_weapon_attunement
    id: &abp_weapon_attunement_id 3
    name: "weapon_attunement"
    label: "Weapon Attunement"
  - &abp_deflection
    id: &abp_deflection_id 4
    name: "deflection"
    label: "Deflection"
  - &abp_mental_prowess
    id: &abp_mental_prowess_id 5
    name: "mental_prowess"
    label: "Mental Prowess"
  - &abp_mental_prowess_choice
    id: &abp_mental_prowess_choice_id 6
    name: "mental_prowess_choice"
    label: "Mental Prowess (Choice)"
  - &abp_physical_prowess
    id: &abp_physical_prowess_id 7
    name: "physical_prowess"
    label: "Physical Prowess"
  - &abp_physical_prowess_choice
    id: &abp_physical_prowess_choice_id 8
    name: "physical_prowess_choice"
    label: "Physical Prowess (Choice)"
  - &abp_toughening
    id: &abp_toughening_id 9
    name: "toughening"
    label: "Toughening"
  # Favored Class Choices
  favored_class_choices:
  - &favored_hp
    id: &favored_hp_id 1
    name: "hp"
    label: "Hit Points"
  - &favored_skill
    id: &favored_skill_id 2
    name: "skill"
    label: "Skill Ranks"
  - &favored_other
    id: &favored_other_id 3
    name: "other"
    label: "Other"

# =============================================================================
# COMMON DEFINITIONS
# =============================================================================
definitions:
  # Effect templates
  effects:
    skill_bonus: &skill_bonus_structure
      skill_name: str
      bonus: int
      type: str

    attribute_modifier: &attribute_modifier_structure
      attribute: str
      modifier: int
      type: str

    weapon_proficiency: &weapon_proficiency_structure
      weapon_name: str

    natural_attack: &natural_attack_structure
      attack_type: str
      damage: str
      attack_count: int

    conditional_bonus: &conditional_bonus_structure
      bonus_type_id: int
      value: int
      apply_to: str
      condition: str

  # Prerequisite templates
  prerequisites:
    feat: &feat_prereq_structure
      type: str
      value: str
      operator: str

# =============================================================================
# 2) BASE TABLES
# =============================================================================
base_tables:
  # First define the string constants
  ancestry_strings:
    tengu: &tengu_name "tengu"
    oread: &oread_name "oread"

  # Then define the full ancestry objects
  ancestries: &ancestries
    - &ancestry_tengu
      id: &tengu_id 1
      name: *tengu_name
      label: "Tengu"

    - &ancestry_oread
      id: &oread_id 2
      name: *oread_name
      label: "Oread"

  skills: &skills
    - &skill_acrobatics
      id: &skill_acrobatics_id 1
      name: "Acrobatics"
      ability: "dex"
      trained_only: false
      armor_check_penalty: true

    - &skill_appraise
      id: &skill_appraise_id 2
      name: "Appraise"
      ability: "int"
      trained_only: false
      armor_check_penalty: false

    - &skill_bluff
      id: &skill_bluff_id 3
      name: "Bluff"
      ability: "cha"
      trained_only: false
      armor_check_penalty: false

    - &skill_climb
      id: &skill_climb_id 4
      name: "Climb"
      ability: "str"
      trained_only: false
      armor_check_penalty: true

    - &skill_craft_alchemy
      id: &skill_craft_alchemy_id 5
      name: "Craft (Alchemy)"
      ability: "int"
      trained_only: false
      armor_check_penalty: false

    - &skill_craft_armor
      id: &skill_craft_armor_id 6
      name: "Craft (Armor)"
      ability: "int"
      trained_only: false
      armor_check_penalty: false

    - &skill_craft_weapons
      id: &skill_craft_weapons_id 7
      name: "Craft (Weapons)"
      ability: "int"
      trained_only: false
      armor_check_penalty: false

    - &skill_diplomacy
      id: &skill_diplomacy_id 8
      name: "Diplomacy"
      ability: "cha"
      trained_only: false
      armor_check_penalty: false

    - &skill_disable_device
      id: &skill_disable_device_id 9
      name: "Disable Device"
      ability: "dex"
      trained_only: true
      armor_check_penalty: true

    - &skill_disguise
      id: &skill_disguise_id 10
      name: "Disguise"
      ability: "cha"
      trained_only: false
      armor_check_penalty: false

    - &skill_escape_artist
      id: &skill_escape_artist_id 11
      name: "Escape Artist"
      ability: "dex"
      trained_only: false
      armor_check_penalty: true

    - &skill_fly
      id: &skill_fly_id 12
      name: "Fly"
      ability: "dex"
      trained_only: false
      armor_check_penalty: true

    - &skill_handle_animal
      id: &skill_handle_animal_id 13
      name: "Handle Animal"
      ability: "cha"
      trained_only: true
      armor_check_penalty: false

    - &skill_heal
      id: &skill_heal_id 14
      name: "Heal"
      ability: "wis"
      trained_only: false
      armor_check_penalty: false

    - &skill_intimidate
      id: &skill_intimidate_id 15
      name: "Intimidate"
      ability: "cha"
      trained_only: false
      armor_check_penalty: false

    - &skill_knowledge_arcana
      id: &skill_knowledge_arcana_id 16
      name: "Knowledge (Arcana)"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_knowledge_dungeoneering
      id: &skill_knowledge_dungeoneering_id 17
      name: "Knowledge (Dungeoneering)"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_knowledge_engineering
      id: &skill_knowledge_engineering_id 18
      name: "Knowledge (Engineering)"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_knowledge_geography
      id: &skill_knowledge_geography_id 19
      name: "Knowledge (Geography)"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_knowledge_history
      id: &skill_knowledge_history_id 20
      name: "Knowledge (History)"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_knowledge_local
      id: &skill_knowledge_local_id 21
      name: "Knowledge (Local)"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_knowledge_nature
      id: &skill_knowledge_nature_id 22
      name: "Knowledge (Nature)"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_knowledge_nobility
      id: &skill_knowledge_nobility_id 23
      name: "Knowledge (Nobility)"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_knowledge_planes
      id: &skill_knowledge_planes_id 24
      name: "Knowledge (Planes)"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_knowledge_religion
      id: &skill_knowledge_religion_id 25
      name: "Knowledge (Religion)"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_linguistics
      id: &skill_linguistics_id 26
      name: "Linguistics"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_perception
      id: &skill_perception_id 27
      name: "Perception"
      ability: "wis"
      trained_only: false
      armor_check_penalty: false

    - &skill_profession
      id: &skill_profession_id 28
      name: "Profession"
      ability: "wis"
      trained_only: true
      armor_check_penalty: false

    - &skill_ride
      id: &skill_ride_id 29
      name: "Ride"
      ability: "dex"
      trained_only: false
      armor_check_penalty: true

    - &skill_sense_motive
      id: &skill_sense_motive_id 30
      name: "Sense Motive"
      ability: "wis"
      trained_only: false
      armor_check_penalty: false

    - &skill_sleight_of_hand
      id: &skill_sleight_of_hand_id 31
      name: "Sleight of Hand"
      ability: "dex"
      trained_only: true
      armor_check_penalty: true

    - &skill_spellcraft
      id: &skill_spellcraft_id 32
      name: "Spellcraft"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_stealth
      id: &skill_stealth_id 33
      name: "Stealth"
      ability: "dex"
      trained_only: false
      armor_check_penalty: true

    - &skill_survival
      id: &skill_survival_id 34
      name: "Survival"
      ability: "wis"
      trained_only: false
      armor_check_penalty: false

    - &skill_swim
      id: &skill_swim_id 35
      name: "Swim"
      ability: "str"
      trained_only: false
      armor_check_penalty: true

    - &skill_use_magic_device
      id: &skill_use_magic_device_id 36
      name: "Use Magic Device"
      ability: "cha"
      trained_only: true
      armor_check_penalty: false

# =============================================================================
# 3) RPG ENTITIES
# =============================================================================
rpg_entities:
  # Move classes definition up before features that reference them
  classes:
  - &class_alchemist
    id: &class_alchemist_id 1
    name: "Alchemist"
    description: "Masters of chemical mixtures and magical potions"
    hit_die: 8
    base_skill_ranks: 4
    class_skills: &alchemist_class_skills
      - *skill_appraise
      - *skill_craft_alchemy
      - *skill_disable_device
      - *skill_fly
      - *skill_heal
      - *skill_knowledge_arcana
      - *skill_knowledge_nature
      - *skill_perception
      - *skill_profession
      - *skill_sleight_of_hand
      - *skill_spellcraft
      - *skill_survival
      - *skill_use_magic_device

  - &class_kineticist
    id: &class_kineticist_id 2
    name: "Kineticist"
    description: "Masters of elemental power"
    hit_die: 10
    base_skill_ranks: 4
    class_skills: &kineticist_class_skills
      - *skill_acrobatics
      - *skill_craft_alchemy
      - *skill_heal
      - *skill_intimidate
      - *skill_perception
      - *skill_profession
      - *skill_stealth
      - *skill_use_magic_device
  # Templates can stay as is
  templates:
    class_feature: &class_feature_template
      entity_type: "class_feature"
      subtype_data:
        class_id: int
        feature_level: int

    ancestral_trait: &ancestral_trait_template
      entity_type: "ancestral_trait"
      subtype_data:
        ancestry_name: str
        is_optional: bool

    trait: &trait_template
      entity_type: "trait"
      subtype_data:
        trait_type: str

    feat: &feat_template
      entity_type: "feat"
      subtype_data:
        feat_label: str
        feat_type: str

    buff: &buff_template
      entity_type: "buff"
      subtype_data:
        buff_type_id: int

    corruption: &corruption_template
      entity_type: "corruption"
      subtype_data:
        corruption_stage: int
        manifestation_level: int

  # Now class features can reference the class IDs
  class_features:
  - <<: *class_feature_template
    id: 1
    name: "AlchemicalBombs"
    description: "Can create and throw alchemical bombs"
    subtype_data:
      class_id: 1
      feature_level: 1
    effects:
      skill_bonuses:
      - <<: *skill_bonus_structure
        skill_name: "Craft (Alchemy)"
        bonus: 2
        type: *circumstance

  - <<: *class_feature_template
    id: 2
    name: "Brew Potion"
    description: "Can brew potions of spells known"
    subtype_data:
      class_id: 1
      feature_level: 1

  - <<: *class_feature_template
    id: 3
    name: "ThrowAnything"
    description: "Add Int modifier to thrown weapon damage"
    subtype_data:
      class_id: 1
      feature_level: 1

  - <<: *class_feature_template
    id: 4
    name: "Extracts"
    description: "Can create and use alchemical extracts"
    subtype_data:
      class_id: 1
      feature_level: 1

  - <<: *class_feature_template
    id: 5
    name: "SwiftAlchemy"
    description: "Create alchemical items at twice normal speed"
    subtype_data:
      class_id: 1
      feature_level: 3

  - <<: *class_feature_template
    id: 6
    name: "SwiftPoisoning"
    description: "Apply poison as a move action"
    subtype_data:
      class_id: 1
      feature_level: 4

  - <<: *class_feature_template
    id: 7
    name: "PoisonResistance"
    description: "Gain natural bonus to saves vs poison"
    subtype_data:
      class_id: 1
      feature_level: 2
    effects:
      conditional_bonuses:
      - <<: *conditional_bonus_structure
        bonus_type_id: 8
        value: 2
        apply_to: "saves"
        condition: "vs_poison"

  - <<: *class_feature_template
    id: 8
    name: "Perfect Recall"
    description: "Double Intelligence bonus on Knowledge checks"
    subtype_data:
      class_id: 1
      feature_level: 2

  - <<: *class_feature_template
    id: 9
    name: "Elemental Focus (Earth)"
    description: "Mastery over earth element"
    subtype_data:
      class_id: 2
      feature_level: 1

  - <<: *class_feature_template
    id: 10
    name: "Burn"
    description: "Channel elemental power at the cost of stamina"
    subtype_data:
      class_id: 2
      feature_level: 1

  - <<: *class_feature_template
    id: 11
    name: "Gather Power"
    description: "Focus elemental energy to reduce burn cost"
    subtype_data:
      class_id: 2
      feature_level: 1

  - <<: *class_feature_template
    id: 12
    name: "Kinetic Blast"
    description: "Channel elemental energy as an attack"
    subtype_data:
      class_id: 2
      feature_level: 1

  - <<: *class_feature_template
    id: 13
    name: "Elemental Defense"
    description: "Gain defensive benefits from element"
    subtype_data:
      class_id: 2
      feature_level: 2

  - <<: *class_feature_template
    id: 14
    name: "Elemental Overflow"
    description: "Gain benefits from accepting burn"
    subtype_data:
      class_id: 2
      feature_level: 3

  - <<: *class_feature_template
    id: 15
    name: "Infusion Specialization"
    description: "Reduce burn cost of infusions"
    subtype_data:
      class_id: 2
      feature_level: 5

  - <<: *class_feature_template
    id: 16
    name: "Metakinesis"
    description: "Apply metamagic-like effects to blasts"
    subtype_data:
      class_id: 2
      feature_level: 5
  # Ancestral Traits
  ancestral_traits:
  - <<: *ancestral_trait_template
    id: 101
    name: "Swordtrained"
    description: "Tengus are trained from birth in swordplay."
    subtype_data:
      ancestry_name: *tengu_name
      is_optional: false
    effects:
      weapon_proficiencies:
      - <<: *weapon_proficiency_structure
        weapon_name: "bastard sword"
      - <<: *weapon_proficiency_structure
        weapon_name: "dagger"
      - <<: *weapon_proficiency_structure
        weapon_name: "elven curve blade"
      - <<: *weapon_proficiency_structure
        weapon_name: "falchion"
      - <<: *weapon_proficiency_structure
        weapon_name: "greatsword"
      - <<: *weapon_proficiency_structure
        weapon_name: "kukri"
      - <<: *weapon_proficiency_structure
        weapon_name: "longsword"
      - <<: *weapon_proficiency_structure
        weapon_name: "punching dagger"
      - <<: *weapon_proficiency_structure
        weapon_name: "rapier"
      - <<: *weapon_proficiency_structure
        weapon_name: "scimitar"
      - <<: *weapon_proficiency_structure
        weapon_name: "short sword"
      - <<: *weapon_proficiency_structure
        weapon_name: "two-bladed sword"

  - <<: *ancestral_trait_template
    id: 102
    name: "Natural Weapon"
    description: "A tengu has a bite attack that deals 1d3 points of damage."
    subtype_data:
      ancestry_name: *tengu_name
      is_optional: false
    effects:
      natural_attacks:
      - <<: *natural_attack_structure
        attack_type: "bite"
        damage: "1d3"
        attack_count: 1

  - <<: *ancestral_trait_template
    id: 103
    name: "Gifted Linguist"
    description: "Tengus gain a +4 racial bonus on Linguistics checks, and learn 2 languages each time they gain a rank in Linguistics."
    subtype_data:
      ancestry_name: *tengu_name
      is_optional: false
    effects:
      skill_bonuses:
      - <<: *skill_bonus_structure
        skill_name: "Linguistics"
        bonus: 4
        type: *racial
      special_rules:
      - id: "double_languages"
        description: "Learn 2 languages per rank instead of 1"

  - <<: *ancestral_trait_template
    id: 104
    name: "Low-Light Vision"
    description: "Tengus can see twice as far as humans in conditions of dim light."
    subtype_data:
      ancestry_name: *tengu_name
      is_optional: false
    effects:
      vision_types:
      - "low-light"

  - <<: *ancestral_trait_template
    id: 105
    name: "Sneaky"
    description: "Tengus gain a +2 racial bonus on Perception and Stealth checks."
    subtype_data:
      ancestry_name: *tengu_name
      is_optional: false
    effects:
      skill_bonuses:
      - <<: *skill_bonus_structure
        skill_name: "Perception"
        bonus: 2
        type: *racial
      - <<: *skill_bonus_structure
        skill_name: "Stealth"
        bonus: 2
        type: *racial

  - <<: *ancestral_trait_template
    id: 106
    name: "Carrion Sense"
    description: "Limited scent ability, only for corpses & badly wounded creatures (50% HP or less)."
    subtype_data:
      ancestry_name: *tengu_name
      is_optional: true
    effects:
      special_rules:
      - id: "limited_scent"
        description: "Can detect badly wounded creatures and corpses"

  - <<: *ancestral_trait_template
    id: 107
    name: "Claw Attack"
    description: "Two claw attacks as primary natural attacks (1d3). Treated as having Improved Unarmed Strike."
    subtype_data:
      ancestry_name: *tengu_name
      is_optional: true
    effects:
      natural_attacks:
      - <<: *natural_attack_structure
        attack_type: "claws"
        damage: "1d3"
        attack_count: 2
      bonus_feats:
      - "Improved Unarmed Strike"

  - <<: *ancestral_trait_template
    id: 108
    name: "Deft Swords"
    description: "Gain a +2 dodge bonus to CMD while wielding a swordlike weapon."
    subtype_data:
      ancestry_name: *tengu_name
      is_optional: true
    effects:
      conditional_bonuses:
      - <<: *conditional_bonus_structure
        bonus_type_id: 6
        value: 2
        apply_to: "cmd"
        condition: "wielding_sword"

  - <<: *ancestral_trait_template
    id: 109
    name: "Exotic Weapon Training"
    description: "Choose a number of eastern weapons = 3 + Int bonus, gain proficiency."
    subtype_data:
      ancestry_name: *tengu_name
      is_optional: true
    effects:
      special_rules:
      - id: "eastern_weapon_training"
        description: "Gain proficiency in eastern weapons (3 + Int bonus)"

  - <<: *ancestral_trait_template
    id: 110
    name: "Glide"
    description: "Can make Fly checks to fall safely without damage & potentially glide."
    subtype_data:
      ancestry_name: *tengu_name
      is_optional: true
    effects:
      special_rules:
      - id: "glide"
        description: "Can make Fly checks to glide and fall safely"
  # Traits
  traits:
  - <<: *trait_template
    id: 201
    name: "Pragmatic Activator"
    description: "Use INT instead of CHA for Use Magic Device."
    subtype_data:
      trait_type: "Magic"
    effects:
      skill_modifier_replacements:
      - skill_name: "Use Magic Device"
        from_ability: "cha"
        to_ability: "int"

  - <<: *trait_template
    id: 202
    name: "Clever Wordplay"
    description: "Use INT instead of CHA for one chosen Cha-based skill."
    subtype_data:
      trait_type: "Social"
    effects:
      skill_modifier_replacements:
      - skill_name: "choosable"
        from_ability: "cha"
        to_ability: "int"
  # Feats
  feats:
  - <<: *feat_template
    id: 301
    name: "Tengu Wings"
    description: "Allows a Tengu to glide or eventually fly."
    subtype_data:
      feat_label: "Tengu Wings"
      feat_type: "racial"
    prerequisites:
    - type: "ancestry"
      value: "Tengu"
      operator: "="
    - type: "level"
      value: "5"
      operator: ">="

  - <<: *feat_template
    id: 302
    name: "Two Weapon Fighting"
    description: "Reduce penalties for fighting with two weapons."
    subtype_data:
      feat_label: "Two-Weapon Fighting"
      feat_type: "combat"
    prerequisites:
    - type: "ability"
      value: "dex"
      operator: ">="
      score: 15

  - <<: *feat_template
    id: 303
    name: "Rapid Shot"
    description: "Make an extra ranged attack each round."
    subtype_data:
      feat_label: "Rapid Shot"
      feat_type: "combat"
    prerequisites:
    - type: "ability"
      value: "dex"
      operator: ">="
      score: 13
    - type: "feat"
      value: "Point-Blank Shot"
      operator: "="

  - <<: *feat_template
    id: 304
    name: "Deadly Aim"
    description: "Trade accuracy for increased ranged damage."
    subtype_data:
      feat_label: "Deadly Aim"
      feat_type: "combat"
    prerequisites:
    - type: "ability"
      value: "dex"
      operator: ">="
      score: 13
    - type: "base_attack"
      value: "1"
      operator: ">="

  - <<: *feat_template
    id: 305
    name: "Extra Discovery"
    description: "Gain one additional alchemist discovery."
    subtype_data:
      feat_label: "Extra Discovery"
      feat_type: "general"
    prerequisites:
    - type: "class"
      value: "Alchemist"
      operator: "="
    - type: "level"
      value: "2"
      operator: ">="

  - <<: *feat_template
    id: 306
    name: "Breadth of Experience"
    description: "Access knowledge with greater ease."
    subtype_data:
      feat_label: "Breadth of Experience"
      feat_type: "general"

  - <<: *feat_template
    id: 307
    name: "Improved Unarmed Strike"
    description: "You are considered armed even when unarmed."
    subtype_data:
      feat_label: "Improved Unarmed Strike"
      feat_type: "combat"

  - <<: *feat_template
    id: 308
    name: "Power Attack"
    description: "Trade melee attack bonus for damage."
    subtype_data:
      feat_label: "Power Attack"
      feat_type: "combat"
    prerequisites:
    - type: "ability"
      value: "str"
      operator: ">="
      score: 13
    - type: "base_attack"
      value: "1"
      operator: ">="

  - <<: *feat_template
    id: 309
    name: "Weapon Focus (Unarmed Strike)"
    description: "Gain +1 attack bonus with unarmed strikes."
    subtype_data:
      feat_label: "Weapon Focus (Unarmed Strike)"
      feat_type: "combat"
    prerequisites:
    - type: "base_attack"
      value: "1"
      operator: ">="

  - <<: *feat_template
    id: 310
    name: "Dodge"
    description: "+1 dodge bonus to AC."
    subtype_data:
      feat_label: "Dodge"
      feat_type: "combat"
    prerequisites:
    - type: "ability"
      value: "dex"
      operator: ">="
      score: 13
  # Buffs
  buffs:
  - <<: *buff_template
    id: 401
    name: "int_cognatogen"
    description: "Grants an Intelligence bonus"
    subtype_data:
      buff_type_id: *buff_mutagen_id
    effects:
      attribute_modifiers:
      - <<: *attribute_modifier_structure
        attribute: "int"
        modifier: 4
        type: *inherent
      - <<: *attribute_modifier_structure
        attribute: "cha"
        modifier: -2
        type: *inherent

  - <<: *buff_template
    id: 402
    name: "wis_cognatogen"
    description: "Grants a Wisdom bonus"
    subtype_data:
      buff_type_id: *buff_mutagen_id
    effects:
      attribute_modifiers:
      - <<: *attribute_modifier_structure
        attribute: "wis"
        modifier: 4
        type: *inherent
      - <<: *attribute_modifier_structure
        attribute: "cha"
        modifier: -2
        type: *inherent

  - <<: *buff_template
    id: 403
    name: "cha_cognatogen"
    description: "Grants a Charisma bonus"
    subtype_data:
      buff_type_id: *buff_mutagen_id
    effects:
      attribute_modifiers:
      - <<: *attribute_modifier_structure
        attribute: "cha"
        modifier: 4
        type: *inherent
      - <<: *attribute_modifier_structure
        attribute: "wis"
        modifier: -2
        type: *inherent

  - <<: *buff_template
    id: 404
    name: "dex_mutagen"
    description: "Grants a Dexterity bonus"
    subtype_data:
      buff_type_id: *buff_mutagen_id
    effects:
      attribute_modifiers:
      - <<: *attribute_modifier_structure
        attribute: "dex"
        modifier: 4
        type: *inherent
      - <<: *attribute_modifier_structure
        attribute: "wis"
        modifier: -2
        type: *inherent

  - <<: *buff_template
    id: 405
    name: "str_mutagen"
    description: "Grants a Strength bonus"
    subtype_data:
      buff_type_id: *buff_mutagen_id
    effects:
      attribute_modifiers:
      - <<: *attribute_modifier_structure
        attribute: "str"
        modifier: 4
        type: *inherent
      - <<: *attribute_modifier_structure
        attribute: "int"
        modifier: -2
        type: *inherent

  - <<: *buff_template
    id: 406
    name: "con_mutagen"
    description: "Grants a Constitution bonus"
    subtype_data:
      buff_type_id: *buff_mutagen_id
    effects:
      attribute_modifiers:
      - <<: *attribute_modifier_structure
        attribute: "con"
        modifier: 4
        type: *inherent
      - <<: *attribute_modifier_structure
        attribute: "int"
        modifier: -2
        type: *inherent

  - <<: *buff_template
    id: 407
    name: "deadly_aim"
    description: "Trade accuracy for damage with ranged attacks."
    subtype_data:
      buff_type_id: *buff_combat_id
    effects:
      buff_effects:
      - effect_type: "attack_roll"
        modifier: -1
        description: "Penalty to attack rolls"
      - effect_type: "damage_roll"
        modifier: 2
        description: "Increase to damage rolls"

  - <<: *buff_template
    id: 408
    name: "rapid_shot"
    description: "Make an extra ranged attack each round."
    subtype_data:
      buff_type_id: *buff_combat_id
    effects:
      buff_effects:
      - effect_type: "attack_roll"
        modifier: -2
        description: "Attack roll penalty when making extra shot"
      - effect_type: "special"
        description: "Grants one additional attack in a full-attack action"

  - <<: *buff_template
    id: 409
    name: "two_weapon_fighting"
    description: "Reduce penalties when fighting with two weapons"
    subtype_data:
      buff_type_id: *buff_combat_id
    effects:
      buff_effects:
      - effect_type: "attack_roll"
        modifier: -2
        description: "Reduce TWF penalty by 2"
  # Corruptions
  corruptions:
  - <<: *corruption_template
    id: 501
    name: "vampirism"
    description: "The corruption of undeath that thirsts for blood."
    subtype_data:
      corruption_stage: 0
      manifestation_level: 5
    manifestations:
    - id: 1
      name: "Vampiric Grace"
      min_manifestation_level: 1
      description: "You move with an eerie, graceful speed."
      prerequisite_manifestation: null
      effects:
        attribute_modifiers:
        - <<: *attribute_modifier_structure
          attribute: "dex"
          modifier: 2
          type: *inherent

    - id: 2
      name: "Fangs"
      min_manifestation_level: 2
      description: "Gain a bite attack that drains blood."
      prerequisite_manifestation: null
      effects:
        natural_attacks:
        - <<: *natural_attack_structure
          attack_type: "bite"
          damage: "1d6"
          attack_count: 1
        special_rules:
        - id: "blood_drain"
          description: "Bite attack can drain blood from living creatures"

    - id: 3
      name: "Unlife"
      min_manifestation_level: 3
      description: "You are partially undead, gaining immunities..."
      prerequisite_manifestation: null
      effects:
        damage_immunities:
        - "cold"
        - "electricity"
        condition_immunities:
        - "sleep"
        - "paralysis"

    - id: 4
      name: "Greater Unlife"
      min_manifestation_level: 4
      description: "Stronger undead traits..."
      prerequisite_manifestation: "Unlife"
      effects:
        damage_resistances:
        - resistance_type: "physical"
          value: 5
          except: "silver"
        special_rules:
        - id: "negative_energy_affinity"
          description: "Healed by negative energy, harmed by positive"

    - id: 5
      name: "True Unlife"
      min_manifestation_level: 5
      description: "You are fully undead..."
      prerequisite_manifestation: "Greater Unlife"
      effects:
        type_change: "undead"
        damage_immunities:
        - "poison"
        - "disease"
        condition_immunities:
        - "death_effects"
        - "ability_drain"

# =============================================================================
# 4) CHARACTERS
# =============================================================================
characters:
- id: 1
  name: "Vardon Salvador"
  user_id: "9c4e4bb1-db8d-41df-b796-b9454622eed2"
  class_id: *class_alchemist_id
  ancestry_id: *tengu_id
  level: 5
  current_hp: 30
  max_hp: 30
  archetype_name: "mindchemist"
  is_offline: false

  attributes:
    str: 10
    dex: 14
    con: 12
    int: 16
    wis: 12
    cha: 8

  equipment:
  - id: 1
    name: "Mithral Chainshirt"
    type: "armor"
    equipped: true
    properties:
    - property_key: "armor_bonus"
      property_value: "4"
    - property_key: "max_dex"
      property_value: "6"
    - property_key: "armor_check_penalty"
      property_value: "0"

  - id: 2
    name: "Masterwork Dagger"
    type: "weapon"
    equipped: true
    properties:
    - property_key: "damage"
      property_value: "1d4"
    - property_key: "crit_range"
      property_value: "19-20"
    - property_key: "crit_mult"
      property_value: "2"

  - id: 3
    name: "Alchemist's Kit"
    type: "gear"
    equipped: true
    properties:
    - property_key: "bonus"
      property_value: "2"
    - property_key: "type"
      property_value: "circumstance"

  consumables:
  - consumable_type: "alchemist_fire"
    quantity: 3
  - consumable_type: "acid"
    quantity: 3
  - consumable_type: "tanglefoot"
    quantity: 3

  entity_selections:
    class_features:
    - entity_id: 1 # AlchemicalBombs
      selected_level: 1
      properties:
      - property_key: "damage"
        property_value: "1d6"
      - property_key: "splash_damage"
        property_value: "1"
      - property_key: "range"
        property_value: "20 ft"

    - entity_id: 2 # Brew Potion
      selected_level: 1

    - entity_id: 3 # ThrowAnything
      selected_level: 1

    - entity_id: 4 # Extracts
      selected_level: 1
      properties:
      - property_key: "slots_per_day"
        property_value: '{"1":4,"2":2}'

    - entity_id: 5 # SwiftAlchemy
      selected_level: 3

    - entity_id: 6 # SwiftPoisoning
      selected_level: 4

    - entity_id: 7 # PoisonResistance
      selected_level: 2

    - entity_id: 8 # Perfect Recall
      selected_level: 2

    discoveries:
    - name: "Infusion"
      selected_level: 2

    - name: "Precise Bombs"
      selected_level: 2

    - name: "Mutagen"
      selected_level: 2

    - name: "Explosive Bomb"
      selected_level: 4

    corruption:
      corruption_type: "vampirism"
      corruption_stage: 0
      manifestation_level: 5
      blood_required: 5
      blood_consumed: 0
      active_manifestations:
      - entity_id: 1 # Vampiric Grace
      - entity_id: 2 # Fangs
      - entity_id: 3 # Unlife
      - entity_id: 4 # Greater Unlife
      - entity_id: 5 # True Unlife

  abp_bonuses:
  - bonus_type_id: *abp_resistance_id
    value: 2
  - bonus_type_id: *abp_deflection_id
    value: 2
  - bonus_type_id: *abp_armor_attunement_id
    value: 1
  - bonus_type_id: *abp_weapon_attunement_id
    value: 1
  - bonus_type_id: *abp_mental_prowess_id
    value: 2
    choices:
    - key: "ability_1"
      value: "int"
  - bonus_type_id: *abp_physical_prowess_id
    value: 2
    choices:
    - key: "ability_1"
      value: "dex"

  extracts:
  - name: "Shield"
    level: 1
    prepared: 2
    used: 0
  - name: "Cure Light Wounds"
    level: 1
    prepared: 1
    used: 0
  - name: "Enlarge Person"
    level: 1
    prepared: 1
    used: 0
  - name: "Invisibility"
    level: 2
    prepared: 1
    used: 0
  - name: "Bull's Strength"
    level: 2
    prepared: 1
    used: 0

  favored_class_bonuses:
  - level: 1
    choice_id: *favored_hp_id
  - level: 2
    choice_id: *favored_skill_id
  - level: 3
    choice_id: *favored_other_id
  - level: 4
    choice_id: *favored_other_id
  - level: 5
    choice_id: *favored_other_id

  skill_ranks:
  - skill_id: *skill_craft_alchemy_id
    source_id: *source_class_id
    ranks_per_level:
      1: 1
      2: 1
      3: 1
      4: 1
      5: 1

  - skill_id: *skill_disable_device_id
    source_id: *source_class_id
    ranks_per_level:
      1: 1
      2: 1
      3: 1
      4: 1
      5: 1

  - skill_id: *skill_knowledge_arcana_id
    source_id: *source_class_id
    ranks_per_level:
      1: 1
      2: 1
      3: 1
      4: 1
      5: 1

- id: 2
  name: "Kiliq Said"
  user_id: "9c4e4bb1-db8d-41df-b796-b9454622eed2"
  class_id: *class_kineticist_id
  ancestry_id: *oread_id
  level: 5
  current_hp: 65
  max_hp: 65
  is_offline: false

  attributes:
    str: 16
    dex: 12
    con: 14
    int: 8
    wis: 12
    cha: 10

  entity_selections:
    class_features:
    - entity_id: 9 # Elemental Focus (Earth)
      selected_level: 1
      properties:
      - property_key: "element"
        property_value: "earth"

    - entity_id: 10 # Burn
      selected_level: 1
      properties:
      - property_key: "max_burn"
        property_value: "6"
      - property_key: "burn_per_round"
        property_value: "2"

    - entity_id: 11 # Gather Power
      selected_level: 1
      properties:
      - property_key: "burn_reduction"
        property_value: "1"

    - entity_id: 12 # Kinetic Blast
      selected_level: 1
      properties:
      - property_key: "damage"
        property_value: "2d6+3"
      - property_key: "type"
        property_value: "physical"

    - entity_id: 13 # Elemental Defense
      selected_level: 2
      properties:
      - property_key: "name"
        property_value: "flesh_of_stone"

    - entity_id: 14 # Elemental Overflow
      selected_level: 3
      properties:
      - property_key: "bonus"
        property_value: "1"

    - entity_id: 15 # Infusion Specialization
      selected_level: 5
      properties:
      - property_key: "level"
        property_value: "1"

    - entity_id: 16 # Metakinesis
      selected_level: 5
      properties:
      - property_key: "type"
        property_value: "empower"

    wild_talents:
    - name: "Basic Geokinesis"
      selected_level: 1

    - name: "Kinetic Fist"
      selected_level: 1

    - name: "Earth Walk"
      selected_level: 2

    - name: "Tremorsense"
      selected_level: 4

    feats:
    - entity_id: 307 # Improved Unarmed Strike
      selected_level: 1

    - entity_id: 308 # Power Attack
      selected_level: 1

    - entity_id: 309 # Weapon Focus (Unarmed Strike)
      selected_level: 3

    - entity_id: 310 # Dodge
      selected_level: 5

    corruption:
      corruption_type: "vampirism"
      corruption_stage: 0
      manifestation_level: 5
      blood_required: 5
      blood_consumed: 0
      active_manifestations:
      - entity_id: 1 # Vampiric Grace
      - entity_id: 2 # Fangs
      - entity_id: 3 # Unlife
      - entity_id: 4 # Greater Unlife
      - entity_id: 5 # True Unlife

  abp_bonuses:
  - bonus_type_id: *abp_resistance_id
    value: 2
  - bonus_type_id: *abp_deflection_id
    value: 2
  - bonus_type_id: *abp_armor_attunement_id
    value: 1
  - bonus_type_id: *abp_weapon_attunement_id
    value: 1
  - bonus_type_id: *abp_mental_prowess_id
    value: 2
    choices:
    - key: "ability_1"
      value: "wis"
  - bonus_type_id: *abp_physical_prowess_id
    value: 2
    choices:
    - key: "ability_1"
      value: "str"

  favored_class_bonuses:
  - level: 1
    choice_id: *favored_hp_id
  - level: 2
    choice_id: *favored_hp_id
  - level: 3
    choice_id: *favored_hp_id
  - level: 4
    choice_id: *favored_hp_id
  - level: 5
    choice_id: *favored_hp_id

  skill_ranks:
  - skill_id: *skill_acrobatics_id
    source_id: *source_class_id
    ranks_per_level:
      1: 1
      2: 1
      3: 1
      4: 1
      5: 1

  - skill_id: *skill_perception_id
    source_id: *source_class_id
    ranks_per_level:
      1: 1
      2: 1
      3: 1
      4: 1
      5: 1

  - skill_id: *skill_stealth_id
    source_id: *source_class_id
    ranks_per_level:
      1: 1
      2: 1
      3: 1
      4: 1
      5: 1

  - skill_id: *skill_climb_id
    source_id: *source_class_id
    ranks_per_level:
      1: 1
      2: 1
      3: 0
      4: 0
      5: 0

  - skill_id: *skill_knowledge_dungeoneering_id
    source_id: *source_class_id
    ranks_per_level:
      1: 0
      2: 0
      3: 1
      4: 1
      5: 1

# =============================================================================
# 5) CLASS SKILL RELATIONS
# =============================================================================
class_skill_relations:
- class_id: *class_alchemist_id
  skill_ids:
  - *skill_appraise_id
  - *skill_craft_alchemy_id
  - *skill_disable_device_id
  - *skill_fly_id
  - *skill_heal_id
  - *skill_knowledge_arcana_id
  - *skill_knowledge_nature_id
  - *skill_perception_id
  - *skill_profession_id
  - *skill_sleight_of_hand_id
  - *skill_spellcraft_id
  - *skill_survival_id
  - *skill_use_magic_device_id

- class_id: *class_kineticist_id
  skill_ids:
  - *skill_acrobatics_id
  - *skill_craft_alchemy_id
  - *skill_heal_id
  - *skill_intimidate_id
  - *skill_perception_id
  - *skill_profession_id
  - *skill_stealth_id
  - *skill_use_magic_device_id
