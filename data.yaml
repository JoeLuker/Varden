# =============================================================================
# METADATA
# =============================================================================
metadata:
  version: "1.0.0"
  game_system: "pathfinder_1e"
  schema_version: "1"

user_id: &user_id "9c4e4bb1-db8d-41df-b796-b9454622eed2"

# =============================================================================
# 1) REFERENCE TABLES
# =============================================================================
reference_tables:
  # First define the string constants
  bonus_type_strings:
    untyped: &untyped "Untyped"
    circumstance: &circumstance "Circumstance"
    inherent: &inherent "Inherent"
    enhancement: &enhancement "Enhancement"
    morale: &morale "Morale"
    dodge: &dodge "Dodge"
    racial: &racial "Racial"
    natural: &natural "Natural"

  # Then define the full bonus type objects
  bonus_types:
  - &bonus_untyped_obj
    id: 1
    name: *untyped
    label: "Untyped"
  - &bonus_circumstance_obj
    id: 2
    name: *circumstance
    label: "Circumstance"
  - &bonus_inherent_obj
    id: 3
    name: *inherent
    label: "Inherent"
  - &bonus_enhancement_obj
    id: 4
    name: *enhancement
    label: "Enhancement"
  - &bonus_morale_obj
    id: 5
    name: *morale
    label: "Morale"
  - &bonus_dodge_obj
    id: 6
    name: *dodge
    label: "Dodge"
  - &bonus_racial_obj
    id: 7
    name: *racial
    label: "Racial"
  - &bonus_natural_obj
    id: 8
    name: *natural
    label: "Natural"
  # Skill Rank Sources
  skill_rank_sources:
  - &source_class
    id: &source_class_id 9
    name: "class"
    label: "Class"
  - &source_favored
    id: &source_favored_id 10
    name: "favored_class"
    label: "Favored Class"
  - &source_intelligence
    id: &source_intelligence_id 11
    name: "intelligence"
    label: "Int-based"
  - &source_other
    id: &source_other_id 12
    name: "other"
    label: "Other"
  # Buff Types
  buff_type_strings:
    mutagen: &buff_type_mutagen "Mutagen"
    combat: &buff_type_combat "Combat"
    other: &buff_type_other "Other"

  buff_types:
  - &buff_mutagen
    id: &buff_mutagen_id 13
    name: *buff_type_mutagen
    label: "Mutagen"
  - &buff_combat
    id: &buff_combat_id 14
    name: *buff_type_combat
    label: "Combat"
  - &buff_other
    id: &buff_other_id 15
    name: *buff_type_other
    label: "Other"
  # ABP Bonus Types
  abp_bonus_types:
  - &abp_resistance
    id: &abp_resistance_id 16
    name: "resistance"
    label: "Resistance"
  - &abp_armor_attunement
    id: &abp_armor_attunement_id 17
    name: "armor_attunement"
    label: "Armor Attunement"
  - &abp_weapon_attunement
    id: &abp_weapon_attunement_id 18
    name: "weapon_attunement"
    label: "Weapon Attunement"
  - &abp_deflection
    id: &abp_deflection_id 19
    name: "deflection"
    label: "Deflection"
  - &abp_mental_prowess
    id: &abp_mental_prowess_id 20
    name: "mental_prowess"
    label: "Mental Prowess"
  - &abp_mental_prowess_choice
    id: &abp_mental_prowess_choice_id 21
    name: "mental_prowess_choice"
    label: "Mental Prowess (Choice)"
  - &abp_physical_prowess
    id: &abp_physical_prowess_id 22
    name: "physical_prowess"
    label: "Physical Prowess"
  - &abp_physical_prowess_choice
    id: &abp_physical_prowess_choice_id 23
    name: "physical_prowess_choice"
    label: "Physical Prowess (Choice)"
  - &abp_toughening
    id: &abp_toughening_id 24
    name: "toughening"
    label: "Toughening"
  # Favored Class Choices
  favored_class_choices:
  - &favored_hp
    id: &favored_hp_id 25
    name: "hp"
    label: "Hit Points"
  - &favored_skill
    id: &favored_skill_id 26
    name: "skill"
    label: "Skill Ranks"
  - &favored_other
    id: &favored_other_id 27
    name: "other"
    label: "Other"

# =============================================================================
# COMMON DEFINITIONS
# =============================================================================
definitions:
  # Effect templates
  effects:
    skill_bonus: &skill_bonus_structure
      skill_name: str
      bonus: int
      type: str

    attribute_modifier: &attribute_modifier_structure
      attribute: str
      modifier: int
      type: str

    weapon_proficiency: &weapon_proficiency_structure
      weapon_name: str

    natural_attack: &natural_attack_structure
      attack_type: str
      damage: str
      attack_count: int

    conditional_bonus: &conditional_bonus_structure
      bonus_type_id: int
      value: int
      apply_to: str
      condition: str

  # Prerequisite templates
  prerequisites:
    feat: &feat_prereq_structure
      type: str
      value: str
      operator: str

# =============================================================================
# 2) BASE TABLES
# =============================================================================
base_tables:
  # First define the string constants
  ancestry_strings:
    tengu: &tengu_name "Tengu"
    oread: &oread_name "Oread"

  # Then define the full ancestry objects
  ancestries: &ancestries
    - &ancestry_tengu
      id: &tengu_id 119
      name: *tengu_name
      label: "Tengu"

    - &ancestry_oread
      id: &oread_id 120
      name: *oread_name
      label: "Oread"

  skills: &skills
    - &skill_acrobatics
      id: &skill_acrobatics_id 28
      name: "Acrobatics"
      ability: "dex"
      trained_only: false
      armor_check_penalty: true

    - &skill_appraise
      id: &skill_appraise_id 29
      name: "Appraise"
      ability: "int"
      trained_only: false
      armor_check_penalty: false

    - &skill_bluff
      id: &skill_bluff_id 30
      name: "Bluff"
      ability: "cha"
      trained_only: false
      armor_check_penalty: false

    - &skill_climb
      id: &skill_climb_id 31
      name: "Climb"
      ability: "str"
      trained_only: false
      armor_check_penalty: true

    - &skill_craft_alchemy
      id: &skill_craft_alchemy_id 32
      name: "Craft (Alchemy)"
      ability: "int"
      trained_only: false
      armor_check_penalty: false

    - &skill_diplomacy
      id: &skill_diplomacy_id 35
      name: "Diplomacy"
      ability: "cha"
      trained_only: false
      armor_check_penalty: false

    - &skill_disable_device
      id: &skill_disable_device_id 36
      name: "Disable Device"
      ability: "dex"
      trained_only: true
      armor_check_penalty: true

    - &skill_disguise
      id: &skill_disguise_id 37
      name: "Disguise"
      ability: "cha"
      trained_only: false
      armor_check_penalty: false

    - &skill_escape_artist
      id: &skill_escape_artist_id 38
      name: "Escape Artist"
      ability: "dex"
      trained_only: false
      armor_check_penalty: true

    - &skill_fly
      id: &skill_fly_id 39
      name: "Fly"
      ability: "dex"
      trained_only: false
      armor_check_penalty: true

    - &skill_handle_animal
      id: &skill_handle_animal_id 40
      name: "Handle Animal"
      ability: "cha"
      trained_only: true
      armor_check_penalty: false

    - &skill_heal
      id: &skill_heal_id 41
      name: "Heal"
      ability: "wis"
      trained_only: false
      armor_check_penalty: false

    - &skill_intimidate
      id: &skill_intimidate_id 42
      name: "Intimidate"
      ability: "cha"
      trained_only: false
      armor_check_penalty: false

    - &skill_knowledge_arcana
      id: &skill_knowledge_arcana_id 43
      name: "Knowledge (Arcana)"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_knowledge_dungeoneering
      id: &skill_knowledge_dungeoneering_id 44
      name: "Knowledge (Dungeoneering)"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_knowledge_engineering
      id: &skill_knowledge_engineering_id 45
      name: "Knowledge (Engineering)"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_knowledge_geography
      id: &skill_knowledge_geography_id 46
      name: "Knowledge (Geography)"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_knowledge_history
      id: &skill_knowledge_history_id 47
      name: "Knowledge (History)"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_knowledge_local
      id: &skill_knowledge_local_id 48
      name: "Knowledge (Local)"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_knowledge_nature
      id: &skill_knowledge_nature_id 49
      name: "Knowledge (Nature)"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_knowledge_nobility
      id: &skill_knowledge_nobility_id 50
      name: "Knowledge (Nobility)"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_knowledge_planes
      id: &skill_knowledge_planes_id 51
      name: "Knowledge (Planes)"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_knowledge_religion
      id: &skill_knowledge_religion_id 52
      name: "Knowledge (Religion)"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_linguistics
      id: &skill_linguistics_id 53
      name: "Linguistics"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_perception
      id: &skill_perception_id 54
      name: "Perception"
      ability: "wis"
      trained_only: false
      armor_check_penalty: false

    - &skill_profession
      id: &skill_profession_id 55
      name: "Profession"
      ability: "wis"
      trained_only: true
      armor_check_penalty: false

    - &skill_ride
      id: &skill_ride_id 56
      name: "Ride"
      ability: "dex"
      trained_only: false
      armor_check_penalty: true

    - &skill_sense_motive
      id: &skill_sense_motive_id 57
      name: "Sense Motive"
      ability: "wis"
      trained_only: false
      armor_check_penalty: false

    - &skill_sleight_of_hand
      id: &skill_sleight_of_hand_id 58
      name: "Sleight of Hand"
      ability: "dex"
      trained_only: true
      armor_check_penalty: true

    - &skill_spellcraft
      id: &skill_spellcraft_id 59
      name: "Spellcraft"
      ability: "int"
      trained_only: true
      armor_check_penalty: false

    - &skill_stealth
      id: &skill_stealth_id 60
      name: "Stealth"
      ability: "dex"
      trained_only: false
      armor_check_penalty: true

    - &skill_survival
      id: &skill_survival_id 61
      name: "Survival"
      ability: "wis"
      trained_only: false
      armor_check_penalty: false

    - &skill_swim
      id: &skill_swim_id 62
      name: "Swim"
      ability: "str"
      trained_only: false
      armor_check_penalty: true

    - &skill_use_magic_device
      id: &skill_use_magic_device_id 63
      name: "Use Magic Device"
      ability: "cha"
      trained_only: true
      armor_check_penalty: false

  attributes:
  - &attr_str
    id: &attr_str_id 401
    name: "Strength"
    entity_type: "attribute"
    attribute_type: "physical"

  - &attr_dex
    id: &attr_dex_id 402
    name: "Dexterity"
    entity_type: "attribute"
    attribute_type: "physical"

  - &attr_con
    id: &attr_con_id 403
    name: "Constitution"
    entity_type: "attribute"
    attribute_type: "physical"

  - &attr_int
    id: &attr_int_id 404
    name: "Intelligence"
    entity_type: "attribute"
    attribute_type: "mental"

  - &attr_wis
    id: &attr_wis_id 405
    name: "Wisdom"
    entity_type: "attribute"
    attribute_type: "mental"

  - &attr_cha
    id: &attr_cha_id 406
    name: "Charisma"
    entity_type: "attribute"
    attribute_type: "mental"

# =============================================================================
# 3) RPG ENTITIES
# =============================================================================
rpg_entities:
  # Move classes definition up before features that reference them
  classes:
  - &class_alchemist
    id: &class_alchemist_id 64
    name: "Alchemist"
    description: "Masters of chemical mixtures and magical potions"
    hit_die: 8
    base_skill_ranks: 4
    # Add saving throw progression
    saving_throws:
      fortitude: "good"
      reflex: "good"
      will: "poor"
    class_skills: &alchemist_class_skills
      - *skill_appraise_id
      - *skill_craft_alchemy_id
      - *skill_disable_device_id
      - *skill_fly_id
      - *skill_heal_id
      - *skill_knowledge_arcana_id
      - *skill_knowledge_nature_id
      - *skill_perception_id
      - *skill_profession_id
      - *skill_sleight_of_hand_id
      - *skill_spellcraft_id
      - *skill_survival_id
      - *skill_use_magic_device_id

  - &class_kineticist
    id: &class_kineticist_id 65
    name: "Kineticist"
    description: "Masters of elemental power"
    hit_die: 10
    base_skill_ranks: 4
    # Add saving throw progression
    saving_throws:
      fortitude: "good"
      reflex: "good"
      will: "poor"
    class_skills: &kineticist_class_skills
      - *skill_acrobatics_id
      - *skill_craft_alchemy_id
      - *skill_heal_id
      - *skill_intimidate_id
      - *skill_perception_id
      - *skill_profession_id
      - *skill_stealth_id
      - *skill_use_magic_device_id
  # Templates can stay as is
  templates:
    class_feature: &class_feature_template
      entity_type: "class_feature"
      subtype_data:
        class_id: int
        feature_level: int

    ancestral_trait: &ancestral_trait_template
      entity_type: "ancestral_trait"
      subtype_data:
        ancestry_name: str
        is_optional: bool

    trait: &trait_template
      entity_type: "trait"
      subtype_data:
        trait_type: str

    feat: &feat_template
      entity_type: "feat"
      subtype_data:
        feat_label: str
        feat_type: str

    buff: &buff_template
      entity_type: "buff"
      subtype_data:
        buff_type_id: int

    corruption: &corruption_template
      entity_type: "corruption"
      subtype_data:
        corruption_stage: int
        manifestation_level: int

  # Now class features can reference the class IDs
  class_features:
  - <<: *class_feature_template
    id: &class_feature_alchemical_bombs_id 66
    name: "AlchemicalBombs"
    description: "Can create and throw alchemical bombs"
    subtype_data:
      class_id: *class_alchemist_id
      feature_level: 1
    effects:
      skill_bonuses:
      - <<: *skill_bonus_structure
        skill_name: "Craft (Alchemy)"
        bonus: 2
        type: *circumstance

  - <<: *class_feature_template
    id: &class_feature_brew_potion_id 67
    name: "Brew Potion"
    description: "Can brew potions of spells known"
    subtype_data:
      class_id: *class_alchemist_id
      feature_level: 1

  - <<: *class_feature_template
    id: &class_feature_throw_anything_id 68
    name: "ThrowAnything"
    description: "Add Int modifier to thrown weapon damage"
    subtype_data:
      class_id: *class_alchemist_id
      feature_level: 1

  - <<: *class_feature_template
    id: &class_feature_extracts_id 69
    name: "Extracts"
    description: "Can create and use alchemical extracts"
    subtype_data:
      class_id: *class_alchemist_id
      feature_level: 1

  - <<: *class_feature_template
    id: &class_feature_swift_alchemy_id 70
    name: "SwiftAlchemy"
    description: "Create alchemical items at twice normal speed"
    subtype_data:
      class_id: *class_alchemist_id
      feature_level: 3

  - <<: *class_feature_template
    id: &class_feature_swift_poisoning_id 71
    name: "SwiftPoisoning"
    description: "Apply poison as a move action"
    subtype_data:
      class_id: *class_alchemist_id
      feature_level: 4

  - <<: *class_feature_template
    id: &class_feature_poison_resistance_id 72
    name: "PoisonResistance"
    description: "Gain natural bonus to saves vs poison"
    subtype_data:
      class_id: *class_alchemist_id
      feature_level: 2
    effects:
      conditional_bonuses:
      - <<: *conditional_bonus_structure
        bonus_type_id: 8
        value: 2
        apply_to: "saves"
        condition: "vs_poison"

  - <<: *class_feature_template
    id: &class_feature_perfect_recall_id 73
    name: "Perfect Recall"
    description: "Double Intelligence bonus on Knowledge checks"
    subtype_data:
      class_id: *class_alchemist_id
      feature_level: 2

  - <<: *class_feature_template
    id: &class_feature_elemental_focus_earth_id 74
    name: "Elemental Focus (Earth)"
    description: "Mastery over earth element"
    subtype_data:
      class_id: *class_kineticist_id
      feature_level: 1

  - <<: *class_feature_template
    id: &class_feature_burn_id 75
    name: "Burn"
    description: "Channel elemental power at the cost of stamina"
    subtype_data:
      class_id: *class_kineticist_id
      feature_level: 1

  - <<: *class_feature_template
    id: &class_feature_gather_power_id 76
    name: "Gather Power"
    description: "Focus elemental energy to reduce burn cost"
    subtype_data:
      class_id: *class_kineticist_id
      feature_level: 1

  - <<: *class_feature_template
    id: &class_feature_kinetic_blast_id 77
    name: "Kinetic Blast"
    description: "Channel elemental energy as an attack"
    subtype_data:
      class_id: *class_kineticist_id
      feature_level: 1

  - <<: *class_feature_template
    id: &class_feature_elemental_defense_id 78
    name: "Elemental Defense"
    description: "Gain defensive benefits from element"
    subtype_data:
      class_id: *class_kineticist_id
      feature_level: 2

  - <<: *class_feature_template
    id: &class_feature_elemental_overflow_id 79
    name: "Elemental Overflow"
    description: "Gain benefits from accepting burn"
    subtype_data:
      class_id: *class_kineticist_id
      feature_level: 3

  - <<: *class_feature_template
    id: &class_feature_infusion_specialization_id 80
    name: "Infusion Specialization"
    description: "Reduce burn cost of infusions"
    subtype_data:
      class_id: *class_kineticist_id
      feature_level: 5

  - <<: *class_feature_template
    id: &class_feature_metakinesis_id 81
    name: "Metakinesis"
    description: "Apply metamagic-like effects to blasts"
    subtype_data:
      class_id: *class_kineticist_id
      feature_level: 5

  - <<: *class_feature_template
    id: &class_feature_cognatogen_id 800
    name: "Cognatogen"
    description: "A mindchemist learns to create a cognatogen, which is a mutagen-like mixture that heightens one mental ability score at the cost of one physical ability score. This ability replaces the standard mutagen class feature."
    subtype_data:
      class_id: *class_alchemist_id
      feature_level: 1
    effects:
      replaces: "mutagen"
      special_rules:
      - id: "cognatogen_creation"
        description: "Can create cognatogens that boost mental stats"
  # Ancestral Traits
  ancestral_traits:
  - <<: *ancestral_trait_template
    id: &ancestral_trait_swordtrained_id 82
    name: "Swordtrained"
    description: "Tengus are trained from birth in swordplay."
    subtype_data:
      ancestry_name: *tengu_name
      is_optional: false
    effects:
      weapon_proficiencies:
      - <<: *weapon_proficiency_structure
        weapon_name: "bastard sword"
      - <<: *weapon_proficiency_structure
        weapon_name: "dagger"
      - <<: *weapon_proficiency_structure
        weapon_name: "elven curve blade"
      - <<: *weapon_proficiency_structure
        weapon_name: "falchion"
      - <<: *weapon_proficiency_structure
        weapon_name: "greatsword"
      - <<: *weapon_proficiency_structure
        weapon_name: "kukri"
      - <<: *weapon_proficiency_structure
        weapon_name: "longsword"
      - <<: *weapon_proficiency_structure
        weapon_name: "punching dagger"
      - <<: *weapon_proficiency_structure
        weapon_name: "rapier"
      - <<: *weapon_proficiency_structure
        weapon_name: "scimitar"
      - <<: *weapon_proficiency_structure
        weapon_name: "short sword"
      - <<: *weapon_proficiency_structure
        weapon_name: "two-bladed sword"

  - <<: *ancestral_trait_template
    id: &ancestral_trait_natural_weapon_id 83
    name: "Natural Weapon"
    description: "A tengu has a bite attack that deals 1d3 points of damage."
    subtype_data:
      ancestry_name: *tengu_name
      is_optional: false
    effects:
      natural_attacks:
      - <<: *natural_attack_structure
        attack_type: "bite"
        damage: "1d3"
        attack_count: 1

  - <<: *ancestral_trait_template
    id: &ancestral_trait_gifted_linguist_id 84
    name: "Gifted Linguist"
    description: "Tengus gain a +4 racial bonus on Linguistics checks, and learn 2 languages each time they gain a rank in Linguistics."
    subtype_data:
      ancestry_name: *tengu_name
      is_optional: false
    effects:
      skill_bonuses:
      - <<: *skill_bonus_structure
        skill_name: "Linguistics"
        bonus: 4
        type: *racial
      special_rules:
      - id: "double_languages"
        description: "Learn 2 languages per rank instead of 1"

  - <<: *ancestral_trait_template
    id: &ancestral_trait_low_light_vision_id 85
    name: "Low-Light Vision"
    description: "Tengus can see twice as far as humans in conditions of dim light."
    subtype_data:
      ancestry_name: *tengu_name
      is_optional: false
    effects:
      vision_types:
      - "low-light"

  - <<: *ancestral_trait_template
    id: &ancestral_trait_sneaky_id 86
    name: "Sneaky"
    description: "Tengus gain a +2 racial bonus on Perception and Stealth checks."
    subtype_data:
      ancestry_name: *tengu_name
      is_optional: false
    effects:
      skill_bonuses:
      - <<: *skill_bonus_structure
        skill_name: "Perception"
        bonus: 2
        type: *racial
      - <<: *skill_bonus_structure
        skill_name: "Stealth"
        bonus: 2
        type: *racial

  - <<: *ancestral_trait_template
    id: &ancestral_trait_carrion_sense_id 87
    name: "Carrion Sense"
    description: "Limited scent ability, only for corpses & badly wounded creatures (50% HP or less)."
    subtype_data:
      ancestry_name: *tengu_name
      is_optional: true
    effects:
      special_rules:
      - id: "limited_scent"
        description: "Can detect badly wounded creatures and corpses"

  - <<: *ancestral_trait_template
    id: &ancestral_trait_claw_attack_id 88
    name: "Claw Attack"
    description: "Two claw attacks as primary natural attacks (1d3). Treated as having Improved Unarmed Strike."
    subtype_data:
      ancestry_name: *tengu_name
      is_optional: true
    effects:
      natural_attacks:
      - <<: *natural_attack_structure
        attack_type: "claws"
        damage: "1d3"
        attack_count: 2
      bonus_feats:
      - "Improved Unarmed Strike"

  - <<: *ancestral_trait_template
    id: &ancestral_trait_deft_swords_id 89
    name: "Deft Swords"
    description: "Gain a +2 dodge bonus to CMD while wielding a swordlike weapon."
    subtype_data:
      ancestry_name: *tengu_name
      is_optional: true
    effects:
      conditional_bonuses:
      - <<: *conditional_bonus_structure
        bonus_type_id: 6
        value: 2
        apply_to: "cmd"
        condition: "wielding_sword"

  - <<: *ancestral_trait_template
    id: &ancestral_trait_exotic_weapon_training_id 90
    name: "Exotic Weapon Training"
    description: "Choose a number of eastern weapons = 3 + Int bonus, gain proficiency."
    subtype_data:
      ancestry_name: *tengu_name
      is_optional: true
    effects:
      special_rules:
      - id: "eastern_weapon_training"
        description: "Gain proficiency in eastern weapons (3 + Int bonus)"

  - <<: *ancestral_trait_template
    id: &ancestral_trait_glide_id 91
    name: "Glide"
    description: "Can make Fly checks to fall safely without damage & potentially glide."
    subtype_data:
      ancestry_name: *tengu_name
      is_optional: true
    effects:
      special_rules:
      - id: "glide"
        description: "Can make Fly checks to glide and fall safely"
  # Traits
  traits:
  - <<: *trait_template
    id: &trait_pragmatic_activator_id 92
    name: "Pragmatic Activator"
    description: "Use INT instead of CHA for Use Magic Device."
    subtype_data:
      trait_type: "Magic"
    effects:
      skill_modifier_replacements:
      - skill_name: "Use Magic Device"
        from_ability: "cha"
        to_ability: "int"

  - <<: *trait_template
    id: &trait_clever_wordplay_id 93
    name: "Clever Wordplay"
    description: "Use INT instead of CHA for one chosen Cha-based skill."
    subtype_data:
      trait_type: "Social"
    effects:
      skill_modifier_replacements:
      - skill_name: "choosable"
        from_ability: "cha"
        to_ability: "int"
  # Feats
  feats:
  - <<: *feat_template
    id: &feat_tengu_wings_id 94
    name: "Tengu Wings"
    description: "Allows a Tengu to glide or eventually fly."
    subtype_data:
      feat_label: "Tengu Wings"
      feat_type: "racial"
    prerequisites:
    - type: "ancestry"
      value: "Tengu"
      operator: "="
    - type: "level"
      value: "5"
      operator: ">="

  - <<: *feat_template
    id: &feat_two_weapon_fighting_id 95
    name: "Two Weapon Fighting"
    description: "Reduce penalties for fighting with two weapons."
    subtype_data:
      feat_label: "Two-Weapon Fighting"
      feat_type: "combat"
    prerequisites:
    - type: "ability"
      value: "dex"
      operator: ">="
      score: 15

  - <<: *feat_template
    id: &feat_rapid_shot_id 96
    name: "Rapid Shot"
    description: "Make an extra ranged attack each round."
    subtype_data:
      feat_label: "Rapid Shot"
      feat_type: "combat"
    prerequisites:
    - type: "ability"
      value: "dex"
      operator: ">="
      score: 13
    - type: "feat"
      value: "Point-Blank Shot"
      operator: "="

  - <<: *feat_template
    id: &feat_deadly_aim_id 97
    name: "Deadly Aim"
    description: "Trade accuracy for increased ranged damage."
    subtype_data:
      feat_label: "Deadly Aim"
      feat_type: "combat"
    prerequisites:
    - type: "ability"
      value: "dex"
      operator: ">="
      score: 13
    - type: "base_attack"
      value: "1"
      operator: ">="

  - <<: *feat_template
    id: &feat_extra_discovery_id 98
    name: "Extra Discovery"
    description: "Gain one additional alchemist discovery."
    subtype_data:
      feat_label: "Extra Discovery"
      feat_type: "general"
    prerequisites:
    - type: "class"
      value: "Alchemist"
      operator: "="
    - type: "level"
      value: "2"
      operator: ">="

  - <<: *feat_template
    id: &feat_breadth_of_experience_id 99
    name: "Breadth of Experience"
    description: "Access knowledge with greater ease."
    subtype_data:
      feat_label: "Breadth of Experience"
      feat_type: "general"

  - <<: *feat_template
    id: &feat_improved_unarmed_strike_id 100
    name: "Improved Unarmed Strike"
    description: "You are considered armed even when unarmed."
    subtype_data:
      feat_label: "Improved Unarmed Strike"
      feat_type: "combat"

  - <<: *feat_template
    id: &feat_power_attack_id 101
    name: "Power Attack"
    description: "Trade melee attack bonus for damage."
    subtype_data:
      feat_label: "Power Attack"
      feat_type: "combat"
    prerequisites:
    - type: "ability"
      value: "str"
      operator: ">="
      score: 13
    - type: "base_attack"
      value: "1"
      operator: ">="

  - <<: *feat_template
    id: &feat_weapon_focus_unarmed_strike_id 102
    name: "Weapon Focus (Unarmed Strike)"
    description: "Gain +1 attack bonus with unarmed strikes."
    subtype_data:
      feat_label: "Weapon Focus (Unarmed Strike)"
      feat_type: "combat"
    prerequisites:
    - type: "base_attack"
      value: "1"
      operator: ">="

  - <<: *feat_template
    id: &feat_dodge_id 103
    name: "Dodge"
    description: "+1 dodge bonus to AC."
    subtype_data:
      feat_label: "Dodge"
      feat_type: "combat"
    prerequisites:
    - type: "ability"
      value: "dex"
      operator: ">="
      score: 13
  # Buffs
  buffs:
  - <<: *buff_template
    id: &buff_int_cognatogen_id 104
    name: "int_cognatogen"
    description: "Grants an Intelligence bonus"
    subtype_data:
      buff_type_id: *buff_mutagen_id
    effects:
      attribute_modifiers:
      - <<: *attribute_modifier_structure
        attribute: "int"
        modifier: 4
        type: *inherent
      - <<: *attribute_modifier_structure
        attribute: "cha"
        modifier: -2
        type: *inherent

  - <<: *buff_template
    id: &buff_wis_cognatogen_id 105
    name: "wis_cognatogen"
    description: "Grants a Wisdom bonus"
    subtype_data:
      buff_type_id: *buff_mutagen_id
    effects:
      attribute_modifiers:
      - <<: *attribute_modifier_structure
        attribute: "wis"
        modifier: 4
        type: *inherent
      - <<: *attribute_modifier_structure
        attribute: "cha"
        modifier: -2
        type: *inherent

  - <<: *buff_template
    id: &buff_cha_cognatogen_id 106
    name: "cha_cognatogen"
    description: "Grants a Charisma bonus"
    subtype_data:
      buff_type_id: *buff_mutagen_id
    effects:
      attribute_modifiers:
      - <<: *attribute_modifier_structure
        attribute: "cha"
        modifier: 4
        type: *inherent
      - <<: *attribute_modifier_structure
        attribute: "wis"
        modifier: -2
        type: *inherent

  - <<: *buff_template
    id: &buff_dex_mutagen_id 107
    name: "dex_mutagen"
    description: "Grants a Dexterity bonus"
    subtype_data:
      buff_type_id: *buff_mutagen_id
    effects:
      attribute_modifiers:
      - <<: *attribute_modifier_structure
        attribute: "dex"
        modifier: 4
        type: *inherent
      - <<: *attribute_modifier_structure
        attribute: "wis"
        modifier: -2
        type: *inherent

  - <<: *buff_template
    id: &buff_str_mutagen_id 108
    name: "str_mutagen"
    description: "Grants a Strength bonus"
    subtype_data:
      buff_type_id: *buff_mutagen_id
    effects:
      attribute_modifiers:
      - <<: *attribute_modifier_structure
        attribute: "str"
        modifier: 4
        type: *inherent
      - <<: *attribute_modifier_structure
        attribute: "int"
        modifier: -2
        type: *inherent

  - <<: *buff_template
    id: &buff_con_mutagen_id 109
    name: "con_mutagen"
    description: "Grants a Constitution bonus"
    subtype_data:
      buff_type_id: *buff_mutagen_id
    effects:
      attribute_modifiers:
      - <<: *attribute_modifier_structure
        attribute: "con"
        modifier: 4
        type: *inherent
      - <<: *attribute_modifier_structure
        attribute: "int"
        modifier: -2
        type: *inherent

  - <<: *buff_template
    id: &buff_deadly_aim_id 110
    name: "deadly_aim"
    description: "Trade accuracy for damage with ranged attacks."
    subtype_data:
      buff_type_id: *buff_combat_id
    effects:
      buff_effects:
      - effect_type: "attack_roll"
        modifier: -1
        description: "Penalty to attack rolls"
      - effect_type: "damage_roll"
        modifier: 2
        description: "Increase to damage rolls"

  - <<: *buff_template
    id: &buff_rapid_shot_id 111
    name: "rapid_shot"
    description: "Make an extra ranged attack each round."
    subtype_data:
      buff_type_id: *buff_combat_id
    effects:
      buff_effects:
      - effect_type: "attack_roll"
        modifier: -2
        description: "Attack roll penalty when making extra shot"
      - effect_type: "special"
        description: "Grants one additional attack in a full-attack action"

  - <<: *buff_template
    id: &buff_two_weapon_fighting_id 112
    name: "two_weapon_fighting"
    description: "Reduce penalties when fighting with two weapons"
    subtype_data:
      buff_type_id: *buff_combat_id
    effects:
      buff_effects:
      - effect_type: "attack_roll"
        modifier: -2
        description: "Reduce TWF penalty by 2"
  # Corruptions
  corruptions:
  - <<: *corruption_template
    id: &corruption_vampirism_id 113
    name: "vampirism"
    description: "The corruption of undeath that thirsts for blood."
    subtype_data:
      corruption_stage: 0
      manifestation_level: 5
    manifestations:
    - id: &corruption_vampiric_grace_id 114
      name: "Vampiric Grace"
      min_manifestation_level: 1
      description: "You move with an eerie, graceful speed."
      prerequisite_manifestation: null
      effects:
        attribute_modifiers:
        - <<: *attribute_modifier_structure
          attribute: "dex"
          modifier: 2
          type: *inherent

    - id: &corruption_fangs_id 115
      name: "Fangs"
      min_manifestation_level: 2
      description: "Gain a bite attack that drains blood."
      prerequisite_manifestation: null
      effects:
        natural_attacks:
        - <<: *natural_attack_structure
          attack_type: "bite"
          damage: "1d6"
          attack_count: 1
        special_rules:
        - id: "blood_drain"
          description: "Bite attack can drain blood from living creatures"

    - id: &corruption_unlife_id 116
      name: "Unlife"
      min_manifestation_level: 3
      description: "You are partially undead, gaining immunities..."
      prerequisite_manifestation: null
      effects:
        damage_immunities:
        - "cold"
        - "electricity"
        condition_immunities:
        - "sleep"
        - "paralysis"

    - id: &corruption_greater_unlife_id 117
      name: "Greater Unlife"
      min_manifestation_level: 4
      description: "Stronger undead traits..."
      prerequisite_manifestation: "Unlife"
      effects:
        damage_resistances:
        - resistance_type: "physical"
          value: 5
          except: "silver"
        special_rules:
        - id: "negative_energy_affinity"
          description: "Healed by negative energy, harmed by positive"

    - id: &corruption_true_unlife_id 118
      name: "True Unlife"
      min_manifestation_level: 5
      description: "You are fully undead..."
      prerequisite_manifestation: "Greater Unlife"
      effects:
        type_change: "undead"
        damage_immunities:
        - "poison"
        - "disease"
        condition_immunities:
        - "death_effects"
        - "ability_drain"
  discoveries:
  - &discovery_infusion
    id: &discovery_infusion_id 200
    name: "Infusion"
    entity_type: "discovery"
    description: "Allows you to infuse extracts so others can benefit from them."

  - &discovery_precise_bombs
    id: &discovery_precise_bombs_id 201
    name: "Precise Bombs"
    entity_type: "discovery"
    description: "Refine your bombs for more precise splash damage."

  - &discovery_mutagen
    id: &discovery_mutagen_id 202
    name: "Mutagen"
    entity_type: "discovery"
    description: "Brew a transformative mutagen that enhances physical or mental abilities."

  - &discovery_explosive_bomb
    id: &discovery_explosive_bomb_id 203
    name: "Explosive Bomb"
    entity_type: "discovery"
    description: "Improves your bomb blasts, increasing their base damage."
  wild_talents:
  - &wild_talent_basic_geokinesis
    id: &wild_talent_basic_geokinesis_id 300
    name: "Basic Geokinesis"
    entity_type: "wild_talent"
    description: "Manipulate earth to perform basic elemental tricks."

  - &wild_talent_kinetic_fist
    id: &wild_talent_kinetic_fist_id 301
    name: "Kinetic Fist"
    entity_type: "wild_talent"
    description: "Channel elemental power into your unarmed strikes."

  - &wild_talent_earth_walk
    id: &wild_talent_earth_walk_id 302
    name: "Earth Walk"
    entity_type: "wild_talent"
    description: "Traverse difficult terrain of rock, mud, or earth with ease."

  - &wild_talent_tremorsense
    id: &wild_talent_tremorsense_id 303
    name: "Tremorsense"
    entity_type: "wild_talent"
    description: "Sense vibrations in the ground to detect nearby creatures."

  consumables:
  - entity_id: &alchemist_fire_entity 500
    entity_type: "consumable"
    name: "Alchemist's Fire"
    description: "A bottle of alchemist's fire."

  - entity_id: &acid_entity 501
    entity_type: "consumable"
    name: "Acid"
    description: "A bottle of acid."

  - entity_id: &tanglefoot_bag_entity 502
    entity_type: "consumable"
    name: "Tanglefoot Bag"
    description: "A bag of sticky, sticky stuff."

  equipment:
  - entity_id: &mithral_chainshirt_entity 600
    entity_type: "equipment"
    name: "Mithral Chainshirt"
    description: "A mithral chainshirt."

  - entity_id: &masterwork_dagger_entity 601
    entity_type: "equipment"
    name: "Masterwork Dagger"
    description: "A masterwork dagger."

  - entity_id: &alchemist_kit_entity 602
    entity_type: "equipment"
    name: "Alchemist's Kit"
    description: "A kit of alchemist's tools."

  - entity_id: &masterwork_longbow_entity 603
    entity_type: "equipment"
    name: "Masterwork Longbow"
    description: "A masterwork longbow."

  - entity_id: &masterwork_longsword_entity 604
    entity_type: "equipment"
    name: "Masterwork Longsword"
    description: "A masterwork longsword."

  extracts:
  - entity_id: &extract_shield_id 700
    entity_type: "extract"
    name: "Shield"
    description: "A shield spell extract."

  - entity_id: &extract_cure_light_wounds_id 701
    entity_type: "extract"
    name: "Cure Light Wounds"
    description: "A cure light wounds extract."

  - entity_id: &extract_enlarge_person_id 702
    entity_type: "extract"
    name: "Enlarge Person"
    description: "An enlarge person extract."

  - entity_id: &extract_invisibility_id 703
    entity_type: "extract"
    name: "Invisibility"
    description: "An invisibility extract."

  - entity_id: &extract_bull_s_strength_id 704
    entity_type: "extract"
    name: "Bull's Strength"
    description: "A bull's strength extract."

# =============================================================================
# 4) CHARACTERS
# =============================================================================
characters:
- id: 1
  name: "Vardon Salvador"
  user_id: *user_id
  current_hp: 37
  max_hp: 37
  is_offline: false

  character_attributes:
  - attribute_id: *attr_str_id
    value: 10

  - attribute_id: *attr_dex_id
    value: 14

  - attribute_id: *attr_con_id
    value: 12

  - attribute_id: *attr_int_id
    value: 16

  - attribute_id: *attr_wis_id
    value: 12

  - attribute_id: *attr_cha_id
    value: 8

  entity_selections:

    classes:
    - entity_id: *class_alchemist_id
      properties:
      - property_key: "level"
        property_value: "6"
      - property_key: "archetype"
        property_value: "Mindchemist"

    ancestries:
    - entity_id: *tengu_id
    # (B) Equipment (armor, weapons, gear)
    equipment:
    - entity_id: *mithral_chainshirt_entity
      properties:
      - property_key: "equipped"
        property_value: "true"
      - property_key: "armor_bonus"
        property_value: "4"
      - property_key: "max_dex"
        property_value: "6"
      - property_key: "armor_check_penalty"
        property_value: "0"

    - entity_id: *masterwork_dagger_entity
      properties:
      - property_key: "equipped"
        property_value: "true"
      - property_key: "damage"
        property_value: "1d4"
      - property_key: "crit_range"
        property_value: "19-20"
      - property_key: "crit_mult"
        property_value: "2"

    - entity_id: *alchemist_kit_entity
      properties:
      - property_key: "equipped"
        property_value: "true"
      - property_key: "bonus"
        property_value: "2"
      - property_key: "type"
        property_value: "circumstance"

    consumables:
    - entity_id: *alchemist_fire_entity
      properties:
      - property_key: "quantity"
        property_value: "3"

    - entity_id: *acid_entity
      properties:
      - property_key: "quantity"
        property_value: "3"

    - entity_id: *tanglefoot_bag_entity
      properties:
      - property_key: "quantity"
        property_value: "3"

    class_features:
    - entity_id: *class_feature_alchemical_bombs_id
      selected_level: 1
      properties:
      - property_key: "damage"
        property_value: "1d6"
      - property_key: "splash_damage"
        property_value: "1"
      - property_key: "range"
        property_value: "20 ft"

    - entity_id: *class_feature_brew_potion_id
      selected_level: 1

    - entity_id: *class_feature_throw_anything_id
      selected_level: 1

    - entity_id: *class_feature_extracts_id
      selected_level: 1
      properties:
      - property_key: "slots_per_day"
        property_value: '{"1":4,"2":2}'

    - entity_id: *class_feature_swift_alchemy_id
      selected_level: 3

    - entity_id: *class_feature_swift_poisoning_id
      selected_level: 4

    - entity_id: *class_feature_poison_resistance_id
      selected_level: 2

    - entity_id: *class_feature_perfect_recall_id
      selected_level: 2

    - entity_id: *class_feature_cognatogen_id
      selected_level: 1

    discoveries:
    - entity_id: *discovery_infusion_id
      name: "Infusion"
      selected_level: 2

    - entity_id: *discovery_precise_bombs_id
      name: "Precise Bombs"
      selected_level: 2

    - entity_id: *discovery_mutagen_id
      name: "Mutagen"
      selected_level: 2

    - entity_id: *discovery_explosive_bomb_id
      name: "Explosive Bomb"
      selected_level: 4

    corruptions:
    - entity_id: *corruption_vampirism_id
      corruption_type: "vampirism"
      corruption_stage: 0
      manifestation_level: 6
      blood_required: 6
      blood_consumed: 0
      active_manifestations:
      - entity_id: *corruption_vampiric_grace_id
      - entity_id: *corruption_fangs_id
      - entity_id: *corruption_unlife_id
      - entity_id: *corruption_greater_unlife_id
      - entity_id: *corruption_true_unlife_id

    feats:
    - entity_id: *feat_deadly_aim_id
      selected_level: 1

    - entity_id: *feat_power_attack_id
      selected_level: 1

    - entity_id: *feat_extra_discovery_id
      selected_level: 1

    - entity_id: *feat_tengu_wings_id
      selected_level: 2

    - entity_id: *feat_two_weapon_fighting_id
      selected_level: 3

    - entity_id: *feat_rapid_shot_id
      selected_level: 4

    - entity_id: *feat_extra_discovery_id
      selected_level: 5

  abp_bonuses:
  - bonus_type_id: *abp_resistance_id
    value: 1
  - bonus_type_id: *abp_deflection_id
    value: 1
  - bonus_type_id: *abp_armor_attunement_id
    value: 1
  - bonus_type_id: *abp_weapon_attunement_id
    value: 1
  - bonus_type_id: *abp_mental_prowess_id
    value: 2
    choices:
    - key: "ability_1"
      value: "int"
  - bonus_type_id: *abp_physical_prowess_id
    value: 2
    choices:
    - key: "ability_1"
      value: "dex"

  extracts:
  - entity_id: *extract_shield_id
    name: "Shield"
    level: 1
    prepared: 2
    used: 0
  - entity_id: *extract_cure_light_wounds_id
    name: "Cure Light Wounds"
    level: 1
    prepared: 1
    used: 0
  - entity_id: *extract_enlarge_person_id
    name: "Enlarge Person"
    level: 1
    prepared: 1
    used: 0
  - entity_id: *extract_invisibility_id
    name: "Invisibility"
    level: 2
    prepared: 1
    used: 0
  - entity_id: *extract_bull_s_strength_id
    name: "Bull's Strength"
    level: 2
    prepared: 1
    used: 0

  favored_class_bonuses:
  - level: 1
    choice_id: *favored_skill_id
  - level: 2
    choice_id: *favored_skill_id
  - level: 3
    choice_id: *favored_skill_id
  - level: 4
    choice_id: *favored_skill_id
  - level: 5
    choice_id: *favored_skill_id
  - level: 5
    choice_id: *favored_skill_id

  skill_ranks:
  - skill_id: *skill_craft_alchemy_id
    source_id: *source_class_id
    ranks_per_level:
      1: 1
      2: 1
      3: 1
      4: 1
      5: 1
      6: 1

  - skill_id: *skill_disable_device_id
    source_id: *source_class_id
    ranks_per_level:
      1: 1
      2: 1
      3: 1
      4: 1
      5: 1
      6: 1

  - skill_id: *skill_knowledge_arcana_id
    source_id: *source_class_id
    ranks_per_level:
      1: 1
      2: 1
      3: 1
      4: 1
      5: 1
      6: 1

- id: 2
  name: "Kiliq Said"
  user_id: *user_id
  current_hp: 67
  max_hp: 67
  is_offline: false

  character_attributes:
  - attribute_id: *attr_str_id
    value: 16

  - attribute_id: *attr_dex_id
    value: 12

  - attribute_id: *attr_con_id
    value: 14

  - attribute_id: *attr_int_id
    value: 8

  - attribute_id: *attr_wis_id
    value: 12

  - attribute_id: *attr_cha_id
    value: 10

  entity_selections:

    classes:
    - entity_id: *class_kineticist_id
      properties:
      - property_key: "level"
        property_value: "6"

    ancestries:
    - entity_id: *oread_id

    class_features:
    - entity_id: *class_feature_elemental_focus_earth_id
      selected_level: 1
      properties:
      - property_key: "element"
        property_value: "Earth"

    - entity_id: *class_feature_burn_id
      selected_level: 1
      properties:
      - property_key: "max_burn"
        property_value: "6"
      - property_key: "burn_per_round"
        property_value: "2"

    - entity_id: *class_feature_gather_power_id
      selected_level: 1
      properties:
      - property_key: "burn_reduction"
        property_value: "1"

    - entity_id: *class_feature_kinetic_blast_id
      selected_level: 1
      properties:
      - property_key: "damage"
        property_value: "2d6+3"
      - property_key: "type"
        property_value: "physical"

    - entity_id: *class_feature_elemental_defense_id
      selected_level: 2
      properties:
      - property_key: "name"
        property_value: "Flesh_of_Stone"

    - entity_id: *class_feature_elemental_overflow_id
      selected_level: 3
      properties:
      - property_key: "bonus"
        property_value: "1"

    - entity_id: *class_feature_infusion_specialization_id
      selected_level: 5
      properties:
      - property_key: "level"
        property_value: "1"

    - entity_id: *class_feature_metakinesis_id
      selected_level: 5
      properties:
      - property_key: "type"
        property_value: "Empower"

    wild_talents:
    - entity_id: *wild_talent_basic_geokinesis_id
      name: "Basic Geokinesis"
      selected_level: 1

    - entity_id: *wild_talent_kinetic_fist_id
      name: "Kinetic Fist"
      selected_level: 1

    - entity_id: *wild_talent_earth_walk_id
      name: "Earth Walk"
      selected_level: 2

    - entity_id: *wild_talent_tremorsense_id
      name: "Tremorsense"
      selected_level: 4

    feats:
    - entity_id: *feat_improved_unarmed_strike_id
      selected_level: 1

    - entity_id: *feat_power_attack_id
      selected_level: 1

    - entity_id: *feat_weapon_focus_unarmed_strike_id
      selected_level: 3

    - entity_id: *feat_dodge_id
      selected_level: 5

    corruptions:
    - entity_id: *corruption_vampirism_id
      corruption_type: "vampirism"
      corruption_stage: 0
      manifestation_level: 6
      blood_required: 6
      blood_consumed: 0
      active_manifestations:
      - entity_id: *corruption_vampiric_grace_id
      - entity_id: *corruption_fangs_id
      - entity_id: *corruption_unlife_id
      - entity_id: *corruption_greater_unlife_id
      - entity_id: *corruption_true_unlife_id

  abp_bonuses:
  - bonus_type_id: *abp_resistance_id
    value: 1
  - bonus_type_id: *abp_deflection_id
    value: 1
  - bonus_type_id: *abp_armor_attunement_id
    value: 1
  - bonus_type_id: *abp_weapon_attunement_id
    value: 1
  - bonus_type_id: *abp_mental_prowess_id
    value: 2
    choices:
    - key: "ability_1"
      value: "wis"
  - bonus_type_id: *abp_physical_prowess_id
    value: 2
    choices:
    - key: "ability_1"
      value: "str"

  favored_class_bonuses:
  - level: 1
    choice_id: *favored_hp_id
  - level: 2
    choice_id: *favored_hp_id
  - level: 3
    choice_id: *favored_hp_id
  - level: 4
    choice_id: *favored_hp_id
  - level: 5
    choice_id: *favored_hp_id
  - level: 6
    choice_id: *favored_hp_id

  skill_ranks:
  - skill_id: *skill_acrobatics_id
    source_id: *source_class_id
    ranks_per_level:
      1: 1
      2: 1
      3: 1
      4: 1
      5: 1
      6: 1

  - skill_id: *skill_perception_id
    source_id: *source_class_id
    ranks_per_level:
      1: 1
      2: 1
      3: 1
      4: 1
      5: 1
      6: 1

  - skill_id: *skill_stealth_id
    source_id: *source_class_id
    ranks_per_level:
      1: 1
      2: 1
      3: 1
      4: 1
      5: 1
      6: 1

  - skill_id: *skill_climb_id
    source_id: *source_class_id
    ranks_per_level:
      1: 1
      2: 1
      3: 0
      4: 0
      5: 0
      6: 0

  - skill_id: *skill_knowledge_dungeoneering_id
    source_id: *source_class_id
    ranks_per_level:
      1: 0
      2: 0
      3: 1
      4: 1
      5: 1
      6: 1
